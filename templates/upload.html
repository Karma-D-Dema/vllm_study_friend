<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Murdoch University Video Learning Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Murdoch University Brand Colors */
            --primary: #E53E3E; /* Murdoch Red */
            --primary-dark: #C53030;
            --primary-light: #FEB2B2;
            --secondary: #2D3748; /* Dark Gray */
            --secondary-light: #4A5568;
            --accent: #F7FAFC; /* Light Gray */
            --light: #FFFFFF;
            --dark: #1A202C;
            --success: #38A169;
            --warning: #D69E2E;
            --danger: #E53E3E;
            --gray-50: #F7FAFC;
            --gray-100: #EDF2F7;
            --gray-200: #E2E8F0;
            --gray-300: #CBD5E0;
            --gray-400: #A0AEC0;
            --gray-500: #718096;
            --gray-600: #4A5568;
            --gray-700: #2D3748;
            --gray-800: #1A202C;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--dark);
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        /* Header with Logo */
        .university-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: var(--light);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            border-bottom: 4px solid var(--primary);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mu-logo {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--primary);
            letter-spacing: -0.05em;
        }

        .university-name {
            font-size: 1.8rem;
            font-weight: 600;
            color: var(--secondary);
            margin: 0;
        }

        .tagline {
            font-size: 1rem;
            color: var(--gray-600);
            margin: 0;
            text-align: center;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 2rem;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
        }

        h1, h2, h3 {
            color: var(--secondary);
            margin-bottom: 0.75rem;
        }

        header h1 {
            color: var(--light);
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        header p {
            color: var(--gray-100);
            font-size: 1.1rem;
            margin: 0;
        }

        h2 {
            font-size: 1.75rem;
            padding-top: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--primary-light);
            margin-top: 1.5rem;
            color: var(--primary-dark);
        }

        h3 {
            font-size: 1.25rem;
            margin-top: 1rem;
            color: var(--secondary);
        }

        p {
            margin-bottom: 1rem;
            color: var(--gray-700);
        }

        .card {
            background-color: var(--light);
            border-radius: 16px;
            box-shadow: var(--shadow-md);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .upload-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, var(--light) 0%, var(--gray-50) 100%);
            border-radius: 16px;
            margin-bottom: 2rem;
            text-align: center;
            border: 2px dashed var(--primary-light);
            transition: all 0.3s ease;
        }

        .upload-section:hover {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
        }

        .file-input-wrapper {
            position: relative;
            margin-bottom: 1.5rem;
            width: 100%;
            max-width: 400px;
        }

        .file-input-label {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px 20px;
            background-color: var(--light);
            color: var(--gray-700);
            border: 2px dashed var(--primary);
            border-radius: 12px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .file-input-label:hover {
            background-color: var(--gray-50);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .file-input-label i {
            margin-right: 8px;
            color: var(--primary);
        }

        #videoInput {
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .file-name {
            margin-top: 8px;
            font-size: 0.9rem;
            color: var(--gray-500);
            text-align: center;
            min-height: 20px;
            font-weight: 500;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-weight: 600;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            user-select: none;
            padding: 12px 24px;
            border-radius: 50px;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 1rem;
            margin: 0.5rem;
            border: none;
            text-decoration: none;
        }

        .btn-primary {
            color: var(--light);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            box-shadow: var(--shadow-md);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-primary:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .btn-secondary {
            color: var(--light);
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn-secondary:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .loading {
            display: none;
            margin: 2rem 0;
            padding: 2rem;
            background-color: var(--light);
            border-radius: 16px;
            text-align: center;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
        }

        .progress-container {
            width: 100%;
            background-color: var(--gray-200);
            border-radius: 50px;
            margin: 1.5rem 0;
            overflow: hidden;
            box-shadow: inset var(--shadow-sm);
        }

        .progress-bar {
            width: 0%;
            height: 12px;
            background: linear-gradient(90deg, var(--primary) 0%, var(--primary-dark) 100%);
            border-radius: 50px;
            transition: width 0.5s ease;
            text-align: center;
            color: var(--light);
            font-size: 0;
            line-height: 12px;
            font-weight: 600;
        }

        .processing-steps {
            text-align: left;
            margin: 1.5rem auto;
            max-width: 500px;
        }

        .processing-step {
            margin: 12px 0;
            padding: 12px 16px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .processing-step i {
            margin-right: 12px;
            font-size: 1.2rem;
            width: 20px;
        }

        .step-pending {
            color: var(--gray-500);
            background-color: var(--gray-100);
        }

        .step-active {
            color: var(--light);
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            font-weight: 600;
            box-shadow: var(--shadow-md);
            transform: translateX(8px);
        }

        .step-complete {
            color: var(--light);
            background: linear-gradient(135deg, var(--success) 0%, #2F855A 100%);
            font-weight: 600;
            box-shadow: var(--shadow-sm);
        }

        .error {
            display: none;
            color: var(--light);
            padding: 15px 20px;
            background: linear-gradient(135deg, var(--danger) 0%, #C53030 100%);
            margin: 1rem 0;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            animation: shake 0.5s ease;
            font-weight: 500;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }

        .content-section {
            background-color: var(--light);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-md);
            border-left: 4px solid var(--primary);
        }

        .transcript, .summary {
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--gray-200);
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .topic-summary {
            background-color: var(--light);
            padding: 0;
            border-radius: 12px;
            margin: 1.5rem 0;
        }

        .topic {
            margin-bottom: 1.5rem;
            background-color: var(--light);
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .topic:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .topic:last-child {
            margin-bottom: 0;
        }

        .topic h3 {
            margin-top: 0;
            color: var(--primary-dark);
        }

        .key-points {
            margin-top: 1rem;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            padding: 1rem;
            border-radius: 8px;
            border-left: 3px solid var(--primary-light);
        }

        .key-points ul {
            padding-left: 1.5rem;
            margin: 0;
        }

        .key-points li {
            margin-bottom: 8px;
            position: relative;
            color: var(--gray-700);
        }

        .key-points li::marker {
            color: var(--primary);
        }

        .question {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            border: 1px solid var(--gray-200);
            border-radius: 12px;
            background-color: var(--light);
            box-shadow: var(--shadow-sm);
            transition: all 0.3s ease;
            border-left: 4px solid var(--primary-light);
        }

        .question:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
            border-left-color: var(--primary);
        }

        .question h3 {
            margin-top: 0;
            color: var(--primary-dark);
            border-bottom: 1px solid var(--gray-200);
            padding-bottom: 0.75rem;
        }

        .question label {
            display: block;
            margin: 10px 0;
            padding: 12px 16px;
            background-color: var(--gray-50);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--gray-200);
        }

        .question label:hover {
            background-color: var(--gray-100);
            border-color: var(--primary-light);
            transform: translateX(4px);
        }

        .question input[type="radio"] {
            margin-right: 10px;
            accent-color: var(--primary);
        }

        .answer {
            color: var(--light);
            font-weight: 600;
            margin-top: 1rem;
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--success) 0%, #2F855A 100%);
            border-radius: 8px;
            display: none;
            box-shadow: var(--shadow-sm);
        }

        .download-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: linear-gradient(135deg, var(--gray-50) 0%, var(--gray-100) 100%);
            border-radius: 16px;
            margin: 2rem 0;
            text-align: center;
            border: 2px solid var(--primary-light);
        }

        .pdf-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 24px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .pdf-btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .pdf-btn:disabled {
            background: var(--gray-400);
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .download-progress {
            width: 100%;
            max-width: 400px;
            display: none;
            margin-top: 1.5rem;
        }

        .btn-disabled {
            background: var(--gray-400) !important;
            cursor: not-allowed !important;
            box-shadow: none !important;
            transform: none !important;
        }

        /* Chat component styles */
        .chat-container {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 350px;
            max-width: 90vw;
            height: 500px;
            max-height: 70vh;
            background-color: var(--light);
            border-radius: 16px;
            box-shadow: var(--shadow-lg);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: all 0.3s ease;
            overflow: hidden;
            border: 1px solid var(--gray-200);
        }

        .chat-container.minimized {
            height: 50px;
        }

        .chat-header {
            padding: 12px 16px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .chat-header h3 {
            margin: 0;
            font-size: 1rem;
            color: var(--light);
            font-weight: 600;
        }

        .chat-header i {
            margin-right: 8px;
        }

        .minimize-chat {
            background: none;
            border: none;
            color: var(--light);
            cursor: pointer;
            font-size: 1rem;
            padding: 4px;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .minimize-chat:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            background-color: var(--gray-50);
        }

        .chat-input-container {
            display: flex;
            padding: 12px;
            border-top: 1px solid var(--gray-200);
            background-color: var(--light);
        }

        .chat-input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--gray-300);
            border-radius: 20px;
            font-size: 0.9rem;
            outline: none;
            transition: border-color 0.2s ease;
        }

        .chat-input:focus {
            border-color: var(--primary);
        }

        .chat-send {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .chat-send:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .chat-message {
            display: flex;
            gap: 10px;
            max-width: 85%;
        }

        .bot-message {
            align-self: flex-start;
        }

        .user-message {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 0.8rem;
        }

        .bot-message .message-avatar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
        }

        .user-message .message-avatar {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-light) 100%);
            color: var(--light);
        }

        .message-content {
            background-color: var(--light);
            padding: 10px 14px;
            border-radius: 18px;
            font-size: 0.9rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--gray-200);
        }

        .bot-message .message-content {
            border-top-left-radius: 4px;
        }

        .user-message .message-content {
            border-top-right-radius: 4px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
            border-color: var(--primary);
        }

        .toggle-chat {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: var(--light);
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .toggle-chat:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(229, 62, 62, 0.4);
        }

        .chat-typing {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 8px 12px;
            border-radius: 12px;
            background-color: var(--light);
            font-size: 0.8rem;
            color: var(--gray-500);
            align-self: flex-start;
            border: 1px solid var(--gray-200);
            box-shadow: var(--shadow-sm);
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background-color: var(--primary);
            border-radius: 50%;
            animation: typing-dot 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing-dot {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-4px);
            }
        }

        .chat-container.minimized .chat-messages,
        .chat-container.minimized .chat-input-container {
            display: none;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }

            .university-header {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }

            .university-header .university-name {
                font-size: 1.4rem;
            }

            .mu-logo {
                font-size: 2rem;
            }

            .card, .content-section {
                padding: 1.25rem;
            }

            header h1 {
                font-size: 2rem;
            }

            h2 {
                font-size: 1.5rem;
            }

            .btn {
                padding: 10px 20px;
            }

            .chat-container {
                width: 300px;
                bottom: 70px;
            }
        }


            .upload-tabs {
                display: flex;
                gap: 1rem;
                margin-bottom: 2rem;
                justify-content: center;
            }

            .tab-button {
                padding: 12px 24px;
                border: 2px solid var(--primary);
                background-color: white;
                color: var(--primary);
                border-radius: 25px;
                cursor: pointer;
                font-weight: 500;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
            }

                .tab-button:hover {
                    background-color: var(--gray-100);
                }

                .tab-button.active {
                    background-color: var(--primary);
                    color: white;
                }

                .upload-method {
                    display: none;
                    width: 100%;
                    max-width: 500px;
                    margin: 0 auto;
                }

                .upload-method.active {
                    display: block;
                }

                .url-input-wrapper {
                    display: flex;
                    gap: 10px;
                    width: 100%;
                    margin-bottom: 1rem;
                }

                .url-input {
                    flex: 1;
                    padding: 12px 16px;
                    border: 2px solid var(--gray-300);
                    border-radius: 8px;
                    font-size: 1rem;
                    transition: border-color 0.3s ease;
                }

                .url-input:focus {
                    outline: none;
                    border-color: var(--primary);
                }

                .url-input.valid {
                    border-color: var(--success);
                }

                .url-input.invalid {
                    border-color: var(--danger);
                }

                .btn-small {
                    padding: 12px 16px;
                    font-size: 0.9rem;
                    white-space: nowrap;
                }

                .url-status {
                    min-height: 24px;
                    font-size: 0.9rem;
                    margin-bottom: 8px;
                }

                .url-status.success {
                    color: var(--success);
                }

                .url-status.error {
                    color: var(--danger);
                }

                .url-status.info {
                    color: var(--primary);
                }

                .url-examples {
                    text-align: center;
                    color: var(--gray-500);
                    margin-bottom: 1rem;
                }

                .url-examples small {
                    font-size: 0.8rem;
                }

                /* Loading state for URL validation */
                .validating {
                    position: relative;
                }

                .validating::after {
                    content: '';
                    position: absolute;
                    right: 12px;
                    top: 50%;
                    transform: translateY(-50%);
                    width: 16px;
                    height: 16px;
                    border: 2px solid var(--primary);
                    border-top: 2px solid transparent;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }

                @keyframes spin {
                    0% { transform: translateY(-50%) rotate(0deg); }
                    100% { transform: translateY(-50%) rotate(360deg); }
                }
    </style>
</head>
<body>
    <!-- University Header with Logo -->
    <div class="university-header">
        <div class="logo-container">
            <div class="mu-logo">MU</div>
            <div>
                <h2 class="university-name">Murdoch University</h2>
                <p class="tagline">Video Learning Assistant</p>
            </div>
        </div>
    </div>

    <header>
        <h1>AI-Powered Video Analysis</h1>
        <p>Upload an educational video to generate intelligent transcripts, comprehensive summaries, and interactive quizzes to enhance your learning experience.</p>
    </header>

    <div class="upload-section">
    <div class="upload-icon">
        <i class="fas fa-cloud-upload-alt"></i>
    </div>
    <h2>Process Your Video</h2>
    <p>Upload a video file or provide a video URL</p>

    <!-- Tab buttons -->
    <div class="upload-tabs">
        <button id="fileTab" class="tab-button active" onclick="switchTab('file')">
            <i class="fas fa-file-upload"></i> Upload File
        </button>
        <button id="urlTab" class="tab-button" onclick="switchTab('url')">
            <i class="fas fa-link"></i> From URL
        </button>
    </div>

    <!-- File upload section -->
    <div id="fileUploadSection" class="upload-method active">
        <div class="file-input-wrapper">
            <label for="videoInput" class="file-input-label">
                <i class="fas fa-file-video"></i>
                Choose Video File
            </label>
            <input type="file" id="videoInput" accept="video/*">
            <div id="fileName" class="file-name"></div>
        </div>
    </div>

    <!-- URL input section -->
    <div id="urlUploadSection" class="upload-method">
        <div class="url-input-wrapper">
            <input type="url" id="videoUrlInput" class="url-input" placeholder="Enter video URL (YouTube, direct video link, etc.)">
            <button id="validateUrlBtn" class="btn btn-secondary btn-small">
                <i class="fas fa-check"></i> Validate
            </button>
        </div>
        <div id="urlStatus" class="url-status"></div>
        <div class="url-examples">
            <small>
                <strong>Supported:</strong> YouTube URLs, Direct video links (.mp4, .avi, .mov, etc.)
            </small>
        </div>
    </div>

    <button id="analyzeBtn" class="btn btn-primary btn-disabled" disabled>
        <i class="fas fa-magic"></i> Analyze Video
    </button>
</div>

    <div id="loading" class="loading">
        <h3>Processing Your Video</h3>
        <p>This may take a few minutes depending on the video length. Please don't close the browser.</p>

        <div class="progress-container">
            <div id="progressBar" class="progress-bar">0%</div>
        </div>

        <div class="processing-steps">
            <div id="step1" class="processing-step step-pending">
                <i class="fas fa-upload"></i> Uploading video...
            </div>
            <div id="step2" class="processing-step step-pending">
                <i class="fas fa-volume-up"></i> Extracting audio...
            </div>
            <div id="step3" class="processing-step step-pending">
                <i class="fas fa-language"></i> Transcribing audio...
            </div>
            <div id="step4" class="processing-step step-pending">
                <i class="fas fa-align-left"></i> Generating summary...
            </div>
            <div id="step5" class="processing-step step-pending">
                <i class="fas fa-question-circle"></i> Creating quiz questions...
            </div>
        </div>
    </div>

    <div id="error" class="error"></div>
    <div id="results"></div>

    <div id="chatContainer" class="chat-container" style="display: none;">
        <div class="chat-header">
            <h3><i class="fas fa-robot"></i> Learning Assistant</h3>
            <button id="minimizeChat" class="minimize-chat"><i class="fas fa-minus"></i></button>
        </div>
        <div id="chatMessages" class="chat-messages">
            <div class="chat-message bot-message">
                <div class="message-content">
                    Hello! I'm your Murdoch University learning assistant. Ask me any questions about the video content you've uploaded.
                </div>
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="chatInput" class="chat-input" placeholder="Ask a question about the video...">
            <button id="sendChatBtn" class="chat-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <button id="toggleChatBtn" class="toggle-chat" style="display: none;">
        <i class="fas fa-comment-dots"></i>
    </button>

    <script>
// Store the response data globally
let responseData = null;

// Global variables for URL processing
let currentUploadMethod = 'file';
let urlValidated = false;

// Get the elements once the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, setting up event listeners');

    // Ensure all elements are available before using them
    const videoInput = document.getElementById('videoInput');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const loading = document.getElementById('loading');
    const error = document.getElementById('error');
    const results = document.getElementById('results');
    const progressBar = document.getElementById('progressBar');
    const fileName = document.getElementById('fileName');
    const processingSteps = [
        document.getElementById('step1'),
        document.getElementById('step2'),
        document.getElementById('step3'),
        document.getElementById('step4'),
        document.getElementById('step5')
    ];

    // Chat elements
    const toggleChatBtn = document.getElementById('toggleChatBtn');
    const chatContainer = document.getElementById('chatContainer');
    const chatMessages = document.getElementById('chatMessages');
    const chatInput = document.getElementById('chatInput');
    const sendChatBtn = document.getElementById('sendChatBtn');
    const minimizeChat = document.getElementById('minimizeChat');
    const chatHeader = document.querySelector('.chat-header');

    // URL elements
    const urlInput = document.getElementById('videoUrlInput');
    const validateBtn = document.getElementById('validateUrlBtn');
    const urlStatus = document.getElementById('urlStatus');

    // Function to update progress
    function updateProgress(step, percent) {
        console.log(`Progress: Step ${step}, ${percent}%`);

        // Update progress bar
        if (progressBar) {
            progressBar.style.width = percent + '%';
            progressBar.textContent = percent + '%';
        }

        // Update step indicators
        for (let i = 0; i < processingSteps.length; i++) {
            const stepElement = processingSteps[i];
            if (!stepElement) continue;

            if (i < step - 1) {
                stepElement.className = 'processing-step step-complete';
                // Replace any icon with check icon for completed steps
                const icon = stepElement.querySelector('i');
                if (icon && !icon.classList.contains('fa-check')) {
                    icon.className = 'fas fa-check';
                }
            } else if (i === step - 1) {
                stepElement.className = 'processing-step step-active';
            } else {
                stepElement.className = 'processing-step step-pending';
            }
        }
    }

    // Function to show errors
    function showError(message) {
        console.error('Showing error:', message);
        if (error) {
            error.innerHTML = `<i class="fas fa-exclamation-circle"></i> ${message}`;
            error.style.display = 'block';

            // Hide error after 8 seconds
            setTimeout(() => {
                error.style.display = 'none';
            }, 8000);
        }
    }

    // Tab switching functionality
    function switchTab(method) {
        console.log('Switching to tab:', method);
        currentUploadMethod = method;

        // Update tab buttons
        const tabButtons = document.querySelectorAll('.tab-button');
        tabButtons.forEach(btn => btn.classList.remove('active'));

        const activeTab = document.getElementById(method + 'Tab');
        if (activeTab) activeTab.classList.add('active');

        // Update upload sections
        const uploadMethods = document.querySelectorAll('.upload-method');
        uploadMethods.forEach(section => section.classList.remove('active'));

        const activeSection = document.getElementById(method + 'UploadSection');
        if (activeSection) activeSection.classList.add('active');

        // Reset validation state when switching tabs
        if (method === 'url') {
            urlValidated = false;
            clearUrlStatus();
        }

        // Update button state
        updateAnalyzeButtonState();
    }

    function clearUrlStatus() {
        if (urlStatus) {
            urlStatus.textContent = '';
            urlStatus.className = 'url-status';
        }
        if (urlInput) {
            urlInput.className = 'url-input';
        }
        urlValidated = false;
    }

    function updateAnalyzeButtonState() {
        if (!analyzeBtn) return;

        let canAnalyze = false;

        if (currentUploadMethod === 'file') {
            canAnalyze = videoInput && videoInput.files && videoInput.files.length > 0;
        } else if (currentUploadMethod === 'url') {
            const hasUrl = urlInput && urlInput.value.trim();
            canAnalyze = hasUrl && urlValidated;
        }

        console.log('Button state - Method:', currentUploadMethod, 'Can analyze:', canAnalyze);

        analyzeBtn.disabled = !canAnalyze;
        if (canAnalyze) {
            analyzeBtn.classList.remove('btn-disabled');
        } else {
            analyzeBtn.classList.add('btn-disabled');
        }
    }

    // Event listener for file selection
    if (videoInput) {
        videoInput.addEventListener('change', function() {
            console.log('File input changed', videoInput.files);

            if (videoInput.files && videoInput.files.length > 0) {
                if (fileName) fileName.textContent = videoInput.files[0].name;
                console.log('File selected:', videoInput.files[0].name);
            } else {
                if (fileName) fileName.textContent = '';
                console.log('No file selected');
            }
            updateAnalyzeButtonState();
        });
    }

    // URL validation functionality
    if (validateBtn && urlInput && urlStatus) {
        validateBtn.addEventListener('click', async function() {
            console.log('Validate button clicked');

            const videoUrl = urlInput.value.trim();

            if (!videoUrl) {
                urlStatus.textContent = 'Please enter a video URL';
                urlStatus.className = 'url-status error';
                return;
            }

            // Show loading state
            validateBtn.disabled = true;
            validateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Validating...';
            urlStatus.textContent = 'Validating URL...';
            urlStatus.className = 'url-status info';

            try {
                const response = await fetch('/validate-video-url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ video_url: videoUrl })
                });

                const result = await response.json();
                console.log('Validation result:', result);

                if (result.valid) {
                    urlStatus.textContent = `✅ Valid ${result.url_type} URL - ${result.note}`;
                    urlStatus.className = 'url-status success';
                    urlInput.className = 'url-input valid';
                    urlValidated = true;
                } else {
                    urlStatus.textContent = `❌ ${result.error}`;
                    urlStatus.className = 'url-status error';
                    urlInput.className = 'url-input invalid';
                    urlValidated = false;
                }

            } catch (error) {
                console.error('Validation error:', error);
                urlStatus.textContent = `❌ Validation failed: ${error.message}`;
                urlStatus.className = 'url-status error';
                urlInput.className = 'url-input invalid';
                urlValidated = false;
            } finally {
                // Reset button state
                validateBtn.disabled = false;
                validateBtn.innerHTML = '<i class="fas fa-check"></i> Validate';
                updateAnalyzeButtonState();
            }
        });

        // Auto-validate on URL input change (with debouncing)
        let urlValidationTimeout;
        urlInput.addEventListener('input', function() {
            clearTimeout(urlValidationTimeout);
            urlValidated = false;
            clearUrlStatus();
            updateAnalyzeButtonState();

            urlValidationTimeout = setTimeout(() => {
                const url = this.value.trim();
                if (url) {
                    validateBtn.click();
                }
            }, 1000);
        });
    }

    // ✅ FIXED: Main analyze button event listener
    if (analyzeBtn) {
        analyzeBtn.addEventListener('click', async function() {
            console.log('🔥 Analyze button clicked - Method:', currentUploadMethod);

            if (currentUploadMethod === 'file') {
                // File upload logic
                const file = videoInput ? videoInput.files[0] : null;
                if (!file) {
                    console.log('No file selected');
                    showError('Please select a video file first');
                    return;
                }

                const formData = new FormData();
                formData.append('video', file);
                console.log('Processing file:', file.name);

                await processVideo('/analyze', formData, file.name);

            } else if (currentUploadMethod === 'url') {
                // URL processing logic
                const videoUrl = urlInput ? urlInput.value.trim() : '';

                if (!videoUrl || !urlValidated) {
                    console.log('URL not ready - URL:', !!videoUrl, 'Validated:', urlValidated);
                    showError('Please enter and validate a video URL first');
                    return;
                }

                const requestData = {
                    video_url: videoUrl
                };
                console.log('Processing URL:', videoUrl);

                await processVideo('/analyze-url', requestData, videoUrl);
            }
        });
    }

    // Unified video processing function
    async function processVideo(endpoint, data, identifier) {
        console.log(`🚀 Processing video - Endpoint: ${endpoint}, Identifier: ${identifier}`);

        // Reset UI
        if (error) error.style.display = 'none';
        if (results) results.innerHTML = '';
        if (loading) loading.style.display = 'block';
        if (analyzeBtn) {
            analyzeBtn.disabled = true;
            analyzeBtn.classList.add('btn-disabled');
        }

        // Start progress simulation
        updateProgress(1, 5);

        try {
            let uploadComplete = false;
            setTimeout(() => {
                if (!uploadComplete) updateProgress(2, 30);
            }, 2000);

            console.log(`Sending request to: ${endpoint}`);

            let requestOptions;
            if (data instanceof FormData) {
                // File upload
                requestOptions = {
                    method: 'POST',
                    body: data
                };
            } else {
                // JSON data (URL)
                requestOptions = {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                };
            }

            const response = await fetch(endpoint, requestOptions);
            console.log('Response status:', response.status);
            uploadComplete = true;

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Server returned ${response.status}: ${errorText}`);
            }

            // Continue with progress simulation
            updateProgress(3, 50);
            setTimeout(() => updateProgress(4, 70), 1500);
            setTimeout(() => updateProgress(5, 90), 3000);

            const result = await response.json();
            console.log('✅ Response parsed successfully');

            // Complete progress
            updateProgress(5, 100);

            setTimeout(() => {
                if (loading) loading.style.display = 'none';

                if (result.error) {
                    console.error('Error from server:', result.error);
                    showError(result.error);
                } else {
                    console.log('🎉 Displaying results');
                    displayResults(result);

                    // Show chat button when results are displayed
                    if (toggleChatBtn) toggleChatBtn.style.display = 'flex';
                }

                // Re-enable button
                if (analyzeBtn) {
                    analyzeBtn.disabled = false;
                    analyzeBtn.classList.remove('btn-disabled');
                }
            }, 1000);

        } catch (err) {
            console.error('💥 Error during analysis:', err);
            if (loading) loading.style.display = 'none';
            showError('Error: ' + err.message);

            if (analyzeBtn) {
                analyzeBtn.disabled = false;
                analyzeBtn.classList.remove('btn-disabled');
            }
        }
    }

    // Function to display results
    function displayResults(data) {
        console.log('Displaying results:', data);

        // Store the response data for PDF generation and chat
        responseData = data;

        let html = `
        <div class="card">
            <h2><i class="fas fa-file-alt"></i> Transcript</h2>
            <div class="transcript">${data.transcript}</div>
        </div>

        <div class="card">
            <h2><i class="fas fa-comment-alt"></i> Summary</h2>
            <div class="summary">${data.summary}</div>
        </div>`;

        // Add topic-wise summary section
        if (data.topic_summary && data.topic_summary.topics) {
            html += `
            <div class="card">
                <h2><i class="fas fa-list-alt"></i> Topic Summary</h2>
                <h3>${data.topic_summary.title || 'Content Summary'}</h3>
                <div class="topic-summary" id="topicsContainer">`;

            data.topic_summary.topics.forEach((topic, i) => {
                html += `
                <div class="topic">
                    <h3>${i+1}. ${topic.heading}</h3>
                    <p>${topic.summary}</p>
                    <div class="key-points">
                        <strong>Key Points:</strong>
                        <ul>`;

                topic.key_points.forEach(point => {
                    html += `<li>${point}</li>`;
                });

                html += `
                        </ul>
                    </div>
                </div>`;
            });

            html += `
                </div>

                <div class="download-section">
                    <button id="generatePdfBtn" class="pdf-btn">
                        <i class="fas fa-file-pdf"></i> Generate PDF Summary
                    </button>
                    <div id="downloadProgress" class="download-progress">
                        <p>Generating PDF...</p>
                        <div class="progress-container">
                            <div id="pdfProgressBar" class="progress-bar">0%</div>
                        </div>
                    </div>
                </div>
            </div>`;
        }

        // Add quiz section
        html += `<div class="card">
            <h2><i class="fas fa-question-circle"></i> Quiz</h2>`;

        try {
            const quiz = JSON.parse(data.quiz);

            if (!quiz.quiz || quiz.quiz.length === 0) {
                html += `<p>No quiz questions available.</p>`;
            } else {
                quiz.quiz.forEach((q, i) => {
                    html += `
                    <div class="question">
                        <h3>Question ${i+1}: ${q.question}</h3>
                        ${q.options.map((o, j) => `
                            <label>
                                <input type="radio" name="q${i}" value="${j}">
                                ${o}
                            </label>
                        `).join('')}
                        <button onclick="showAnswer(${i}, ${q.answer})" class="btn btn-secondary">Show Answer</button>
                        <div id="answer${i}" class="answer"></div>
                    </div>`;
                });
            }
        } catch(e) {
            console.error('Error parsing quiz data:', e);
            html += `<p class="error">Error parsing quiz: ${e.message}</p>`;
        }

        html += `</div>`;

        if (results) results.innerHTML = html;

        // Add event listener for PDF generation
        const generatePdfBtn = document.getElementById('generatePdfBtn');
        if (generatePdfBtn) {
            generatePdfBtn.addEventListener('click', generateAndDownloadPDF);
        }
    }

    // Chat functionality
    if (toggleChatBtn && chatContainer) {
        // Toggle chat visibility
        toggleChatBtn.addEventListener('click', function() {
            chatContainer.style.display = 'flex';
            toggleChatBtn.style.display = 'none';

            // If chat was minimized, restore it
            chatContainer.classList.remove('minimized');

            // Focus the input field
            if (chatInput) chatInput.focus();
        });
    }

    if (minimizeChat) {
        // Minimize or restore chat
        minimizeChat.addEventListener('click', function() {
            if (chatContainer) chatContainer.classList.toggle('minimized');
        });
    }

    if (chatHeader) {
        chatHeader.addEventListener('click', function(e) {
            // Only toggle if clicking on the header (not the minimize button)
            if (e.target !== minimizeChat && !minimizeChat.contains(e.target)) {
                if (chatContainer) chatContainer.classList.toggle('minimized');
            }
        });
    }

    // Add user message to chat
    function addUserMessage(message) {
        if (!chatMessages) return;

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', 'user-message');

        messageDiv.innerHTML = `
            <div class="message-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="message-content">
                ${message}
            </div>
        `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Add bot message to chat
    function addBotMessage(message) {
        if (!chatMessages) return;

        const messageDiv = document.createElement('div');
        messageDiv.classList.add('chat-message', 'bot-message');

        messageDiv.innerHTML = `
            <div class="message-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
                ${message}
            </div>
        `;

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Show typing indicator
    function showTypingIndicator() {
        if (!chatMessages) return;

        const typingDiv = document.createElement('div');
        typingDiv.classList.add('chat-typing');
        typingDiv.id = 'typingIndicator';

        typingDiv.innerHTML = `
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
        `;

        chatMessages.appendChild(typingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // Remove typing indicator
    function removeTypingIndicator() {
        const typingIndicator = document.getElementById('typingIndicator');
        if (typingIndicator) {
            typingIndicator.remove();
        }
    }

    // Process user message and generate response
    async function processUserMessage(message) {
        // Add user message to chat
        addUserMessage(message);

        // Show typing indicator
        showTypingIndicator();

        try {
            // Prepare the query data
            const queryData = {
                query: message,
                context: {
                    transcript: responseData.transcript || "",
                    summary: responseData.summary || "",
                    topic_summary: responseData.topic_summary || {},
                    quiz: responseData.quiz || "{}"
                }
            };

            // Send request to the server
            const response = await fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(queryData)
            });

            // Remove typing indicator
            removeTypingIndicator();

            if (!response.ok) {
                const errorText = await response.text();
                throw new Error(`Server returned ${response.status}: ${errorText}`);
            }

            const result = await response.json();

            // Add bot response to chat
            if (result.error) {
                addBotMessage(`I'm sorry, I encountered an error: ${result.error}`);
            } else {
                addBotMessage(result.response);
            }
        } catch (err) {
            // Remove typing indicator
            removeTypingIndicator();

            console.error('Error processing message:', err);

            // If no server endpoint exists yet, use a fallback response based on the content
            let fallbackResponse = generateFallbackResponse(message);
            addBotMessage(fallbackResponse);
        }
    }

    // Generate a fallback response based on the content
    function generateFallbackResponse(message) {
        const transcript = responseData?.transcript || '';
        const summary = responseData?.summary || '';

        // Very simple response generation
        const messageLower = message.toLowerCase();

        // Simple keyword matching
        if (messageLower.includes('summary') || messageLower.includes('overview')) {
            return `Here's a quick summary of the video content: ${summary.substring(0, 150)}...`;
        } else if (messageLower.includes('topic') || messageLower.includes('main point')) {
            const topics = responseData?.topic_summary?.topics || [];
            if (topics.length > 0) {
                return `The main topics covered in this video are: ${topics.map(t => t.heading).join(', ')}`;
            }
        } else if (messageLower.includes('quiz') || messageLower.includes('question')) {
            return "You can find a quiz based on the video content in the Quiz section above. It will help test your understanding of the material.";
        } else if (messageLower.includes('download') || messageLower.includes('pdf')) {
            return "You can download a PDF summary of this video by clicking the 'Generate PDF Summary' button in the Topic Summary section.";
        } else if (messageLower.includes('hello') || messageLower.includes('hi ')) {
            return "Hello! How can I help you understand the video content better?";
        } else if (messageLower.includes('thank')) {
            return "You're welcome! If you have any more questions about the video, feel free to ask.";
        }

        // If no keywords match, search for relevant content
        const words = messageLower.split(/\W+/).filter(w => w.length > 3);

        let relevantContent = '';
        for (const word of words) {
            if (word.length < 4) continue;

            const regex = new RegExp(`[^.!?]*${word}[^.!?]*[.!?]`, 'i');
            const match = transcript.match(regex);

            if (match && match[0]) {
                relevantContent = match[0].trim();
                break;
            }
        }

        if (relevantContent) {
            return `Based on the video content: "${relevantContent}"`;
        }

        // Default response if nothing matches
        return "I'm sorry, I don't have specific information about that from the video. Could you try asking in a different way or ask about another aspect of the content?";
    }

    // Send message when clicking the send button
    if (sendChatBtn && chatInput) {
        sendChatBtn.addEventListener('click', function() {
            const message = chatInput.value.trim();

            if (message) {
                processUserMessage(message);
                chatInput.value = '';
            }
        });

        // Send message when pressing Enter
        chatInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const message = chatInput.value.trim();

                if (message) {
                    processUserMessage(message);
                    chatInput.value = '';
                }
            }
        });
    }

    // Tab initialization - Set up tab buttons
    const fileTab = document.getElementById('fileTab');
    const urlTab = document.getElementById('urlTab');

    if (fileTab) {
        fileTab.addEventListener('click', () => switchTab('file'));
    }
    if (urlTab) {
        urlTab.addEventListener('click', () => switchTab('url'));
    }

    // Initialize the interface
    switchTab('file');
    updateAnalyzeButtonState();

    console.log('✅ All event listeners set up successfully');
});

// ✅ MOVED OUTSIDE: Functions that need to be globally accessible

// Function to show answers (must be defined outside the DOMContentLoaded event)
function showAnswer(questionIndex, answerIndex) {
    const answerDiv = document.getElementById(`answer${questionIndex}`);
    if (answerDiv) {
        answerDiv.innerHTML = `<i class="fas fa-check-circle"></i> Correct Answer: Option ${answerIndex + 1}`;
        answerDiv.style.display = 'block';
    }
}

// Function to generate and download PDF (must be defined outside the DOMContentLoaded event)
async function generateAndDownloadPDF() {
    const error = document.getElementById('error');

    if (!responseData) {
        console.error('No data available for PDF generation');
        if (error) {
            error.innerHTML = `<i class="fas fa-exclamation-circle"></i> No data available for PDF generation`;
            error.style.display = 'block';
            setTimeout(() => { error.style.display = 'none'; }, 5000);
        }
        return;
    }

    const generatePdfBtn = document.getElementById('generatePdfBtn');
    const downloadProgress = document.getElementById('downloadProgress');
    const pdfProgressBar = document.getElementById('pdfProgressBar');

    if (!generatePdfBtn || !downloadProgress || !pdfProgressBar) {
        console.error('Could not find PDF generation elements');
        return;
    }

    try {
        // Show progress
        generatePdfBtn.disabled = true;
        downloadProgress.style.display = 'block';
        pdfProgressBar.style.width = '10%';
        pdfProgressBar.textContent = '10%';

        // Prepare data for PDF generation
        const pdfData = {
            transcript: responseData.transcript || "",
            topic_summary: responseData.topic_summary || {
                title: "Video Summary",
                topics: [{
                    heading: "Content Summary",
                    summary: responseData.transcript ? (responseData.transcript.substring(0, 500) + "...") : "No transcript available",
                    key_points: ["Automatically generated summary"]
                }]
            },
            video_filename: responseData.video_filename || "video.mp4"
        };

        console.log('Generating PDF with data:', pdfData);

        // Update progress
        pdfProgressBar.style.width = '30%';
        pdfProgressBar.textContent = '30%';

        // Send request to generate PDF
        const response = await fetch('/generate-pdf', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(pdfData)
        });

        if (!response.ok) {
            const errorText = await response.text();
            throw new Error(`Server returned ${response.status}: ${errorText}`);
        }

        // Update progress
        pdfProgressBar.style.width = '70%';
        pdfProgressBar.textContent = '70%';

        const result = await response.json();
        console.log('PDF generation response:', result);

        if (result.error) {
            throw new Error(result.error);
        }

        if (!result.filename) {
            throw new Error("No filename returned from server");
        }

        // Update progress
        pdfProgressBar.style.width = '90%';
        pdfProgressBar.textContent = '90%';

        // Extract filename from result
        const filename = result.filename;

        // Create a direct download link
        const downloadLink = document.createElement('a');
        downloadLink.href = `/download-pdf/${filename}`;
        downloadLink.download = filename;
        downloadLink.style.display = 'none';
        document.body.appendChild(downloadLink);
        console.log('Initiating download for:', filename);
        downloadLink.click();

        // Clean up
        setTimeout(() => {
            document.body.removeChild(downloadLink);
        }, 100);

        // Complete progress
        setTimeout(() => {
            pdfProgressBar.style.width = '100%';
            pdfProgressBar.textContent = '100%';

            // Reset UI after a short delay
            setTimeout(() => {
                downloadProgress.style.display = 'none';
                generatePdfBtn.disabled = false;
            }, 1000);
        }, 500);

    } catch (err) {
        console.error("PDF generation error:", err);
        downloadProgress.style.display = 'none';
        generatePdfBtn.disabled = false;

        if (error) {
            error.innerHTML = `<i class="fas fa-exclamation-circle"></i> Error generating PDF: ${err.message}`;
            error.style.display = 'block';
            setTimeout(() => { error.style.display = 'none'; }, 5000);
        }
    }
}

console.log('✅ JavaScript file loaded completely');
</script>
</body>
</html>